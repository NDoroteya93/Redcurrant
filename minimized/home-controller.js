"use strict";import{loadTemplate}from"templates";import{HomeModel}from"homeModel";import{UserController}from"userController";import{TicketsController}from"ticketsController";const LOCAL_STORAGE_USERNAME_KEY="signed-in-user-username",LOCAL_STORAGE_AUTHKEY_KEY="signed-in-user-auth-key";class HomeController{constructor(){this._container=$("#container"),this._userController=new UserController,this._ticketsController=new TicketsController}get container(){return this._container}get userController(){return this._userController}get ticketsController(){return this._ticketsController}loadTemplate(){const a=new loadTemplate("home");let b=this;a.getTemplate().then(a=>{b.container.html(a())})}initHome(){if(null!==localStorage.getItem(LOCAL_STORAGE_USERNAME_KEY)){let a=JSON.parse(localStorage.getItem(LOCAL_STORAGE_USERNAME_KEY));$(".signed-user").removeClass("hidden"),$(".unsigned-user").addClass("hidden"),$(".user-name").text(a.profile.preferred_username),$(".user-email").text(a.profile.email)}let d,a=this,b={authority:"https://130.204.27.87:44314/identity/",client_id:"ticketingsystem",popup_redirect_uri:"http://localhost:92/public/popup.html",silent_redirect_uri:"http://localhost:92/public/silent-renew.html",post_logout_redirect_uri:"http://localhost:92/public/index.html",response_type:"id_token token",scope:"openid profile email ClimbingGymapi",accessTokenExpiringNotificationTime:4,automaticSilentRenew:!0,filterProtocolClaims:!0},c=new Oidc.UserManager(b);return Oidc.Log.logger=console,c.events.addUserLoaded(function(b){d=b;let c=JSON.stringify(b);localStorage.setItem(LOCAL_STORAGE_USERNAME_KEY,c),localStorage.setItem(LOCAL_STORAGE_AUTHKEY_KEY,d.access_token),$(".signed-user").removeClass("hidden"),$(".unsigned-user").addClass("hidden"),a.display(".js-user",d)}),c.events.addSilentRenewError(function(a){console.error("error while renewing the access token",a)}),c.events.addUserSignedOut(function(){$(".signed-user").addClass("hidden"),$(".unsigned-user").removeClass("hidden"),alert("The user has signed out")}),$("#login-btn").on("click",function(){a.userController.login(c)}),$("#token").on("click",function(){JSON.parse(localStorage.getItem(LOCAL_STORAGE_USERNAME_KEY)).access_token}),$("#logout-btn").on("click",function(){localStorage.removeItem(LOCAL_STORAGE_USERNAME_KEY),localStorage.removeItem(LOCAL_STORAGE_AUTHKEY_KEY),a.userController.logout(c)}),$("#searchByTitle").on("click",function(){let b=$("#searchString").val().trim();a.ticketsController.searchTicketByTitle(b),location.href=`/#/FindTiketsByTitle/${b}`}),$("#searchString").on("keypress",function(b){if(13==b.which){let b=$("#searchString").val().trim();a.ticketsController.searchTicketByTitle(b),location.href=`/#/FindTiketsByTitle/${b}`}}),this}display(a,b){$(".user-name").text(b.profile.preferred_username),$(".user-email").text(b.profile.email),b&&"string"==typeof b&&(b=JSON.parse(b)),b&&(b=JSON.stringify(b,null,2)),$(a).text(b)}}export{HomeController};